/* 
 * Maciej Małecki
 * smt116(at)gmail.com
 * http://github.com/smt116/jquery.form/
 * 
 * MIT License http://www.opensource.org/licenses/mit-license.php
 */
(function($){
    $.fn.extend({
        form:function(options){
            var defaults={
                phpLocation: 'post.php',
                imageLocation: 'image/',
                animationTime: 500
            };
            options=$.extend(defaults,options);
            
            var formContainer=$(this);
            var form=formContainer.find('form');
            
            form.submit(function () {
                
                formContainer.css({
                    width: form.width(),
                    height: form.height()
                });
                
                form.fadeOut(options.animationTime, 'linear', function() {
                    formContainer.append('<div class="loading"></div>');
                    $.post(options.phpLocation, form.serializeArray(), function(data) {
                        setTimeout(function() {
                            if(data==null) {
                                data.success='fail';
                                data.header='B\u0142\u0105d';
                                data.msg='<p>B\u0142\u0105d aplikacji. <span class="reset-button">ponowi\u0107 prób\u0119 ?</span></p>'
                            }
                            formContainer.find('div.loading').remove();
                            formContainer.append('<div class="form-message"></div>');
                            var formMessage = formContainer.find('div.form-message');
                            formMessage.hide();
                            formMessage.append('<div class="form-status '+data.success+'"><img src="'+options.imageLocation+data.success+'.png" />'+data.header+'</div>'+(data.msg?''+data.msg+'':'')+'');
                            
                            formMessage.find('span.reset-button').click(function() {
                                formMessage.remove();
                                form.fadeIn(options.animationTime,"linear");
                                $('input[type|=text], textarea').each(function(i,e){
                                    validForm($(e))
                                });
                            })
                            
                            formMessage.fadeIn(options.animationTime, 'linear');
                        }, options.animationTime);
                    }, 'json');
                });
                
                return false;
            });
        }
    })
})(jQuery);